<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  
  
  
  

  

  

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.1/css/academicons.min.css" integrity="sha384-FIue+PI4SsI9XfHCz8dBLg33b0c1fMJgNU3X//L26FYbGnlSEfWmNT7zgWc2N9b6" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link href="https://lymslive.github.io/deep-thought.css" rel="stylesheet" />
  
<link href="/page-patch.css" rel="stylesheet" />


  <title>
    
沉思涧 | mysql 命令行客户端使用经验

  </title>

  
  
  

  
</head>

<body class="has-background-white">
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item is-size-5 has-text-weight-bold" href="https:&#x2F;&#x2F;lymslive.github.io">沉思涧</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;">
            首页
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;blog">
            博客
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;book">
            书册
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;think">
            文思
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;white">
            白学
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;tags">
            标签
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;categories">
            归类
          </a>
          
          
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  
  

  
<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article class="box">
          <h1 class="title">
            mysql 命令行客户端使用经验
          </h1>
          <p class="subtitle"></p>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="fas fa-user"></i>
  </span>
  <span>七阶子</span>
  <span class="icon">
    <i class="far fa-calendar-alt"></i>
  </span>
  <span><time datetime="2018-07-19">2018-07-19</time></span>
</span>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="far fa-clock"></i>
  </span>
  <span>9 min,</span>
  <span class="icon">
    <i class="fas fa-pencil-alt"></i>
  </span>
  <span>1627 words</span>
</span>

            </div>
            <div class="column">
              
              
<p>
  归类：
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://lymslive.github.io/categories/gong-ju-shi-yong/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-cube"></i>
      </span>
      <span>工具使用</span>
    </span>
  </a>
  
</p>

              
            </div>
            <div class="column has-text-right-desktop">
              
              
<p>
  标签：
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://lymslive.github.io/tags/mysql/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>mysql</span>
    </span>
  </a>
  
</p>

              
            </div>
          </div>
          <div class="content mt-2" id="article-content">
            <!-- # mysql 命令行客户端使用经验 -->
<p>首先，Linux 命令行工具，最基本的原则是随时可查手册，<code>man mysql</code>。
当用 <code>mysql</code> 命令从 shell 进入交互环境时，也可用 <code>help</code> 查询基本命令：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mysql</span><span>&gt; help
</span></code></pre>
<p>大多以 <code>\</code> 前缀的转义命令，即可以单独使用，也可以附加在普通查询命令末尾。
有些大写转义命令打开某功能选项，而小写关闭对应的功能。</p>
<span id="continue-reading"></span><h2 id="ji-lu-shi-yong-ri-zhi">记录使用日志</h2>
<p>将查询输出额外保存到外部文件，当作使用日志，这或有妙用。用 <code>\T</code> 命令可达成此效
果，类似于 <code>tee</code> 命令。使用 <code>\t</code> 关闭输出日志。</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mysql</span><span>&gt; </span><span style="color:#96b5b4;">\T</span><span> tee.log
</span></code></pre>
<p>也可以在 shell 启动 mysql 时添加 <code>--tee</code> 选项指定输出日志文件：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> mysql</span><span style="color:#bf616a;"> --tee</span><span>=file.log
</span></code></pre>
<p>如果日常工作频繁依赖使用 mysql ，还可以写个 shell 包装脚本，按当天日期为名记录
不同的输出日志文件。例如，将以下脚本保存为 <code>~/bin/tsql.sh</code> ：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;">#! /bin/bash
</span><span style="color:#bf616a;">LOGDIR</span><span>=$</span><span style="color:#bf616a;">HOME</span><span style="color:#a3be8c;">/mysql
</span><span style="color:#96b5b4;">cd </span><span>$</span><span style="color:#bf616a;">LOGDIR
</span><span style="color:#bf616a;">today</span><span>=$</span><span style="color:#a3be8c;">(</span><span style="color:#bf616a;">date</span><span style="color:#a3be8c;"> +</span><span>%</span><span style="color:#bf616a;">Y</span><span>%</span><span style="color:#bf616a;">m</span><span>%</span><span style="color:#bf616a;">d</span><span style="color:#a3be8c;">)
</span><span style="color:#bf616a;">LOGFILE</span><span>=</span><span style="color:#a3be8c;">tee.log.</span><span>$</span><span style="color:#bf616a;">today
</span><span style="color:#96b5b4;">exec</span><span> mysql -u $</span><span style="color:#bf616a;">USER</span><span> -p$</span><span style="color:#bf616a;">PASS</span><span> -h $</span><span style="color:#bf616a;">HOST</span><span> --tee=$</span><span style="color:#bf616a;">LOGFILE </span><span>&quot;$</span><span style="color:#bf616a;">@</span><span>&quot;
</span></code></pre>
<p>当然，你可以自己选择是否为了方便将用户名、密码及服务器地址等信息一并写到该启动
脚本，抑或是为了安全还是从命令行提示符中输入。</p>
<h2 id="kong-zhi-cha-kan-jie-guo">控制查看结果</h2>
<p>在交互命令中使用的查询，输出结果将以整洁的表格线给出，相信使用过 mysql 的用户
都习以为常了。这在查询的列数较少，可以在终端屏幕宽度内打印时很方便。但在列数很
多或有些文本字段内容过长时，就很难看了。这时可以用 <code>\G</code> 命令将结果以纵向的方式
输出，例如：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mysql</span><span>&gt; SELECT * FROM table_name WHERE ... LIMIT 1 </span><span style="color:#96b5b4;">\G
</span></code></pre>
<p>语句末尾使用 <code>\G</code> 后，不需要额外加分号 <code>;</code> 直接回车即可，且只影响当前查询语句
。此后用分号结尾的语句，仍然按表格线的方式列出。</p>
<p>由于每个字段打印为一行，结果会比较长，故适合查询多列而不太适合查询多条记录。
除了有 <code>WHERE</code> 子句限定选择结果外，还可用 <code>LIMIT</code> 语法限定选出数量。</p>
<p>这个　<code>LIMIT 1</code> 还可作为查看表结构示例的语法，与 <code>desc</code> 或 <code>show create table</code>
各有特色。而且，后者的输出内容较长，最好也用 <code>\G</code> 方式：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mysql</span><span>&gt; SHOW CREATE TABLE table_name </span><span style="color:#96b5b4;">\G
</span></code></pre>
<p>当真的需要以表格化查看太多查询记录时，还可以选择使用其他 pager 工具查看，典型
的如 <code>less</code> 便于上下翻页：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mysql</span><span>&gt; SELECT * FROM table_name WHERE ... </span><span style="color:#96b5b4;">\P</span><span> less
</span></code></pre>
<p>此时将启用 <code>less</code> 全屏查看结果，浏览完毕后按 <code>q</code> 命令退出 <code>less</code> 重回到 <code>mysql</code> 
交互界面。<code>\P</code> 命令选择外部 pager 是长效的，此后的查询结果也会启用外部 pager
，因此不需要这样时用 <code>\n</code> 禁用，或用在 <code>\P</code> 命令后留空不加 pager 参数，二次回
车确认后，将 pager 设为无，也就用 <code>stdout</code> 。</p>
<p>一个更复杂也更人性化的 pager 命令是：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mysql</span><span>&gt; pager less</span><span style="color:#bf616a;"> -n -i -S -F -X
</span></code></pre>
<p>这就涉及 <code>man less</code> 学习 less 的高级用法了。这些选项控制的效果有：<code>-S</code> 使长表
格线不折行，可用左右方向键浏览；<code>-FX</code> 则是智能判断输出记录结果，如果不超过一屏
，就直接显示，不按正常启动 less 。</p>
<p>mysql 也有单行命令模式，即在启动时用 <code>-e</code> 选项指定要执行的 sql 语句，则 mysql
在启动后只执行该语句后立即退出，不进行交互模式。这既可以直接在 shell 命令行中
执行少量 sql 语句，也可以嵌入在 shell 脚本中批量执行特定几个 sql 语句。可以在
一个 <code>-e</code> 选项参数中以 <code>;</code> 分隔多条 sql 语句，也可以用多个 <code>-e</code> 选项。最好将整
个 sql 语句用单引号括起作为 <code>-e</code> 的参数传给 mysql 。这是另一个话题了。</p>
<p>如果直接在 shell 命令行使用单行命令，结果输出到终端的标准输出，默认方式也是表
格化的。如：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> mysql</span><span style="color:#bf616a;"> -e </span><span>&#39;</span><span style="color:#a3be8c;">SELECT * FROM ... WHERE ...</span><span>&#39;
</span></code></pre>
<p>但是如果将 <code>mysql -e</code> 的结果重定向至文件或管道至其他程序时，默认的表格列输出是
没有表格线的，而只有 <code>\t</code> 制表符，这是便于程序处理而不是让人眼查看的考虑。不过
可以再加 <code>-t</code> 选项仍然输出表格线，如：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> mysql</span><span style="color:#bf616a;"> -te </span><span>&#39;</span><span style="color:#a3be8c;">SELECT * FROM ... WHERE ...</span><span>&#39; | </span><span style="color:#bf616a;">less
</span></code></pre>
<p>当然了，可以在单引号内的 sql 语句末尾加 <code>\G</code> 改用纵向输出，不管是直接输出至终
端还是管道重定向。</p>
<h2 id="ming-ling-xing-bian-ji">命令行编辑</h2>
<p>在 mysql 交互界面中编辑命令行与 shell 类似，都是基于 emacs 的快捷键。</p>
<p>清除命令 <code>\c</code> 有个用处是，仍将当前编辑的（不完整或有错误的）语句保存在历史，此
后仍可用 <code>Ctrl-p</code> 调入该命令，在此基础上修改。而如果用 <code>Ctrl-U</code> 真实地清空当前
命令行，则不会记入历史命令。你也不该企图用 <code>Ctrl-C</code> 取消当前 sql 语句命令，因
为那其实是退出 mysql 程序本身的。</p>
<p>如果在输入 sql 语句时，输到一半发现该语句太复杂，则用附加 <code>\e</code> 命令回车调用外
部编辑器（环境变量 $EDITOR ，一般是 vi）来编辑这条语句，编辑完后比如用 <code>:wq</code>
退出编辑器回到 mysql 执行。如果直接在行首使用 <code>\e</code> 或 <code>edit</code> 命令，将编辑上一
条历史命令。</p>
<p>对于真正复杂且常用的 sql 语句，还可保存在外部文件，然后从 mysql 命令行中使用
<code>source</code> 或 <code>\.</code> 命令来加载执行外部 sql 文件。注意记得从 shell 启动 mysql 的当
前路径。</p>
<p>在非交互模式下，也可以用定向输入 sql 文件，这也相当于将不适合 <code>-e</code> 直接输入的
语句先存于外部文件。</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> mysql ... &lt; input.sql
</span></code></pre>
<h2 id="xiao-jie">小结</h2>
<p>虽然 mysql 有很多功能强大的 GUI 工具，但似乎不能完全替代命令行客户端工具。笔者
虽然也装了 GUI 客户端，但只偶尔打开，最常用的还是命令行。所以本文归纳了若干使
用 mysql 命令行客户端程序的小技巧。</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Search</p>
      </header>
      <section class="modal-card-body">
        <div class="field mb-2">
          <div class="control">
            <input class="input" id="search" placeholder="Search this website." type="search" />
          </div>
        </div>
        <div class="search-results">
          <div class="search-results__items"></div>
        </div>
      </section>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


  

<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
               
          <div class="level-item has-text-centered">
            <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;lymslive.github.io&#x2F;blog&#x2F;download-by-wget&#x2F;">
              linux 下载工具 wget 使用经验<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
          
        </nav>
      </div>
    </div>
  </div>
</section>



  



  
  <footer class="footer py-4">
    <div class="content has-text-centered">
      <p>
        Contact
        <a class="has-text-black" href="mailto:403708621@qq.com" target="_blank">
          <span class="icon is-large" title="Email">
            <i class="far fa-envelope fa-lg"></i>
          </span>
        </a>
        Issue
        <a class="has-text-github" href="https://github.com/lymslive/lymslive.github.io/issues" target="_blank">
          <span class="icon is-large" title="GitHub">
            <i class="fab fa-github fa-lg"></i>
          </span>
        </a>
      </p>
      <p>
        Powered by
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-power-off"></i>
          </span>
          <span>zola</span>
        </span>
        with
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-code"></i>
          </span>
          <span>code</span>
        </span>
        and
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-heart"></i>
          </span>
          <span>love</span>
        </span>
      </p>
    </div>
  </footer>
  

  
  
  
  
  <script src="https://lymslive.github.io/elasticlunr.min.js"></script>
  <script src="https://lymslive.github.io/search_index.en.js"></script><script src="https://lymslive.github.io/js/site.js"></script>

  





  
<script src="https://lymslive.github.io/js/chinese-format.js"></script>

</body>

</html>
