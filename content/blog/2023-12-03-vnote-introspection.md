+++
title = "vim 笔记插件 vnote 设计反思"
[taxonomies]
categories = ["程序设计"]
tags = ["C++","json"]
+++

几年前，刚转行为专职程序员不久时，出于对 vim 的喜爱与信仰，自己开发了一个 vim
插件，以支持在 vim 环境内记笔记及管理笔记。我知道市面上有不少笔记软件，但记笔
记这事是很个性化的东西，而且很多吹成云笔记的产品，把个人笔记上传到人家服务器上，
怎么都觉得有点敏感。所以我决定就用 vim 在本地写 markdown 文本笔记，要怎么上传
至 github 托管仓库，也是自己能完全控制的。基于这个出发点，我自行设计并开发
vnote 插件，虽然基本只是给自己用吧，当初也乐此不疲。

但是再过几年回头再看，这个插件软件可能设计的不尽如人意。
<!-- more -->

## vnote 项目概况

项目地址在 [https://github.com/lymslive/vnote](https://github.com/lymslive/vnote)，
这是标准的 vim 插件目录结构。

强依赖另一个 vim 项目，[vimloo](https://github.com/lymslive/vimloo) 。这算是
viml 的基础代码库，我推出的用面向对象的思想来写 viml 代码，很多基础设施就放在
了 `vimloo` 仓库。这两者或许是相辅相成的，也可能是先想到了 `vimloo` ，而
`vnote` 就是个具体的练手项目。

在初期，还有个配套辅助的 C++ 命令行工具，
[lymslive/vnote-tool](https://github.com/lymslive/vnote-tool)
用于为一个笔记本目录生成索引及查询。后来从 vnote 插件仓库剥离出去。可能由于需
要额外编译，使用度不高。原计划想做成 vim 通过异步 channel 与该外部工具的通讯也
没实现。后来又写了几个 perl 脚本，放在 vnote 插件目录，重建索引还更方便。perl
处理文本还是有优势的。

然后我自己实际的笔记本仓库是 
[lymslive/notebook](https://github.com/lymslive/notebook) 。当然现在是设为
private 访问权限，不适合公开的。

比较遗憾的是，这几个仓库，几年后都渐失维护，少有更新了，包含 notebook 内容。

记得 SpaceVim 项目曾收录 vnote 插件，但我本身不喜欢用别人整的开箱即用的配置好
的 vim ，所以也没跟踪 vnote 的使用率。推广与运营，向来不是我所擅长的，但这并不
是我对 vnote 感到纠结的地方。而我主要遗憾的是 vnote 本身渐渐不能让自己满意了。

## vnote 的主要问题

一个主要问题可能是过度设计，对笔记本目录结构与笔记文本名的约定设计偏复杂了。
vnote 假定一篇笔记是一个 markdown 文件，文件名位于
`${NoteBook}/d/yyyy/mm/dd/yyyymmdd_x.md` 。其中为每层年、月、日建立目录，而笔
记文件名也包含 `yyyymmdd` 8 位数字拼接的年月日信息作为前缀，再加个编号后缀，因
为当然设想要支持一天写多篇笔记的情况，所以加编号。

这其中最大的现实问题是，高估了用户（比如我自己）写笔记的热情。一般用户可能很难
坚持每天写笔记，更别说每天写几篇了。所以大部分情况下，三层日目录下只有一个文件
`yyyymmdd_1.md` ，显得很冗余滑稽。还有很多日期是一篇笔记也没有的，也就不会建那
天的目录。但在顶层目录只看到年份，不能直观看到里面哪个月哪天是空缺的。

vim 的哲学是做好一件事，所以仍有时候我想在 shell 下进入笔记本目录去查看，也就
是 `cd` 与 `ls` 的常规。所以三层目录结构的设计造成很大困扰。如果能重新设计，我
想就平坦一层的 `yyyy-mm-dd` 目录会更方便。没必要担心子目录名太多，能写一年也就
三百多个目录，能坚持三年不间断也就一千左右个子目录。类似 `ls` 的命令也完全可以
加上通配符过滤只列某年或某年月的日记目录。

目录太深可能也让我忽略了在每天目录下还能放非 `.md` 文件，如插图，没意识或不方
便去维护可能有用的配图表，最多只用超链接记下参考资料来源。

笔记文件名还有个不良的设计是，可以再加后缀表示私有日记，如 `yyyymmdd_x-.md` ，
可在 `.gitignore` 中加入规则忽略提交。这又进一步增加复杂度。可能当时的 github
免费用户，还不允许设私有仓库。否则将整个笔记本仓库设为私有是最恰当的，完全没必
要在同一个笔记本公私混杂。真有这么闲，可以建两个笔记本仓库，一个公开，一个不公
开。

vnote 的第二个问题是，我在使用过程中可能偏离了它作为简单笔记的初衷。后来还迁入
了大量长篇大论的原创文章，搞得像要维护博客的站点内容一样。

第三个问题也是个人使用的问题，后来没有坚持写笔记了。notebook 仓库在某年开始近
乎停更了。
